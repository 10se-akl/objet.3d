<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Objets 3D ‚Äî Axel & Noah</title>
  <meta name="description" content="Petite boutique locale d'objets imprim√©s en 3D ‚Äî faits main, personnalisables, paiement simple." />

  <!-- Google Fonts -->
  https://fonts.googleapis.com
  https://fonts.gstatic.com
  https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap

  <!-- PayPal SDK (optionnel, simulation) -->
  <!-- https://www.paypal.com/sdk/js?client-id=7HSHKVRHRLSDJ&currency=EUR</script> -->

  <style>
    :root{
      --accent:#ff6600;
      --bg:#fafafa;
      --card:#ffffff;
      --dark:#222;
      --muted:#666;
      --maxw:980px;
      --error:#d32f2f;
      --success:#2e7d32;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter,"Segoe UI",Roboto,Arial,sans-serif;
      background:var(--bg);
      color:#111;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    a{color:inherit;text-decoration:none}
    button{font-family:inherit}

    /* HEADER */
    header{
      position:fixed; top:0; left:0; right:0;
      height:64px;
      background:linear-gradient(180deg,#111 0%, #1a1a1a 100%);
      color:#fff;
      display:flex; align-items:center; justify-content:space-between;
      padding:0 12px; gap:8px;
      z-index:2000; box-shadow:0 4px 18px rgba(0,0,0,.25);
    }
    .brand{display:flex;gap:10px;align-items:center;min-width:0}
    .logo{width:44px;height:44px;border-radius:10px;background:var(--accent);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700}
    .brand h1{margin:0;font-size:18px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    nav.main{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .icon-btn{background:transparent;border:none;color:#fff;cursor:pointer;font-size:14px;padding:8px 10px;border-radius:8px}
    .icon-btn:hover{background:rgba(255,255,255,.08)}

    /* Bouton retour */
    .back-btn{
      position:fixed; top:76px; left:16px; z-index:2500;
      background:#000; color:#fff; border:none; border-radius:50%;
      width:42px; height:42px; font-size:20px; cursor:pointer; display:none;
    }
    .back-btn:hover{opacity:.85}

    /* MAIN */
    main{padding-top:84px;max-width:var(--maxw);margin:24px auto;padding-left:16px;padding-right:16px}

    /* HERO */
    .hero{
      display:flex; flex-wrap:wrap; gap:16px;
      background:linear-gradient(90deg,#fff 0%, #fffaf0 100%);
      padding:20px; border-radius:12px; box-shadow:0 6px 30px rgba(0,0,0,.05);
    }
    .hero .card{flex:1 1 100%}
    .hero .left{flex:1 1 100%}
    .hero .stats{flex:1 1 100%;display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .hero .stats .box{background:#fff;padding:8px 12px;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,.06);min-width:120px}

    /* GRID PRODUITS */
    .grid{margin-top:20px;display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:18px}
    .card{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 6px 18px rgba(0,0,0,.06);display:flex;flex-direction:column;gap:10px}
    .card img{width:100%;height:140px;object-fit:cover;border-radius:8px}
    .card h3{margin:0;font-size:16px;color:var(--dark)}
    .card p{margin:0;color:var(--muted);font-size:14px;min-height:40px}
    .card .meta{display:flex;align-items:center;justify-content:space-between;gap:8px}
    .price{font-weight:700;color:var(--accent)}
    .stock-status{font-size:13px;color:var(--error);font-weight:700}

    /* DETAILS */
    .details-wrap{display:flex;gap:18px;align-items:flex-start}
    .details-left{flex:1;min-width:0}
    .details-right{width:320px;background:var(--card);padding:14px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,.06)}
    .carousel-main{width:100%;height:300px;border-radius:10px;overflow:hidden;background:#eee;display:flex;align-items:center;justify-content:center}
    .carousel-main img{width:100%;height:100%;object-fit:cover}
    .thumbnails{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap}
    .thumbnails img{height:56px;width:75px;object-fit:cover;border-radius:6px;cursor:pointer;opacity:.75;border:2px solid transparent}
    .thumbnails img.active{opacity:1;border-color:var(--accent)}
    .error-msg{color:var(--error);font-size:13px;margin-top:4px}
    .success-msg{color:var(--success);font-size:13px;margin-top:4px}

    /* PANIER */
    table.cart{width:100%;border-collapse:collapse;background:var(--card);border-radius:12px;overflow:hidden;box-shadow:0 6px 18px rgba(0,0,0,.06)}
    table.cart th,table.cart td{padding:12px 14px;text-align:left;border-bottom:1px solid #f0f0f0;font-size:14px}
    table.cart thead{background:#fafafa}
    .btn-primary{background:var(--accent);color:#fff;border:none;padding:12px;border-radius:8px;cursor:pointer;font-weight:700}
    .btn-primary:disabled{opacity:.5;cursor:not-allowed}
    .btn-ghost{background:#f5f5f5;border:1px solid #eee;padding:10px;border-radius:8px;cursor:pointer}
    .small-muted{font-size:13px;color:var(--muted)}

    /* MODAL */
    .modal-backdrop{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.5);z-index:3000;display:none;padding:16px}
    .modal-backdrop.active{display:flex}
    .modal{width:100%;max-width:520px;background:#fff;padding:18px;border-radius:12px;box-shadow:0 12px 40px rgba(0,0,0,.25)}
    .modal h3{margin:0 0 12px 0;color:var(--accent)}
    .modal label{font-weight:600;margin-top:8px;display:block}
    .modal input,.modal select{width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;margin-top:4px;font-size:14px}
    .modal-toggle{text-align:center;margin-top:12px;font-size:13px}
    .modal-toggle a{color:var(--accent);cursor:pointer;text-decoration:underline}
    .modal-actions{display:flex;gap:8px;margin-top:12px}
    .modal-actions button{flex:1}

    /* FOOTER */
    footer.site-footer{
      margin-top:28px;background:#0f0f0f;color:#ddd;padding:16px;border-radius:10px;
      max-width:var(--maxw);margin-left:auto;margin-right:auto;
      display:flex;justify-content:space-between;align-items:flex-start;gap:16px;flex-wrap:wrap;
    }
    .footer-left{font-size:14px}
    .footer-contact{font-size:13px;color:#aaa}
    .footer-contact ul{margin:6px 0 0 18px;color:#ccc}
    .footer-social{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .footer-social a{display:inline-flex;align-items:center;gap:8px;background:#161616;border:1px solid #222;padding:6px 10px;border-radius:8px;color:#eee}
    .footer-social a img{height:18px;width:18px;border-radius:4px;display:block}

    /* RESPONSIVE */
    @media (max-width:860px){
      header{height:auto;padding:10px;gap:8px}
      nav.main{width:100%;justify-content:space-between}
      .details-wrap{flex-direction:column}
      .details-right{width:100%}
      .hero{padding:16px}
      footer.site-footer{flex-direction:column;gap:10px;text-align:center;align-items:center}
      .footer-contact{text-align:center}
    }
    @media (max-width:600px){
      .grid{grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:14px}
      .card img{height:120px}
      .carousel-main{height:240px}
    }
    @media (max-width:480px){
      .grid{grid-template-columns:repeat(2,1fr);gap:12px}
      .thumbnails img{width:56px;height:40px}
      .brand h1{font-size:16px}
    }
  </style>
</head>
<body>

  <button class="back-btn" id="backBtn" aria-label="Retour">‚Üê</button>

  <header role="banner">
    <div class="brand">
      <div class="logo" aria-hidden="true">3D</div>
      <div>
        <h1>Objets 3D ‚Äî Axel &amp; Noah</h1>
        <div style="font-size:12px;color:#e6e6e6">Impression &amp; Cr√©ation locale</div>
      </div>
    </div>

    <nav class="main" aria-label="Navigation principale">
      <button class="icon-btn" id="navAccueil" aria-controls="accueilSection">Accueil</button>
      <button class="icon-btn" id="navBoutique" aria-controls="boutiqueSection">Boutique</button>
      <button class="icon-btn" id="navPanier" aria-controls="panierSection">üõí <span id="nbPanier">0</span></button>
      <div id="authArea" style="display:flex; align-items:center; gap:8px">
        <div id="notLogged" style="display:flex; gap:8px;">
          <button class="icon-btn" id="openLoginBtn">Connexion</button>
          <button class="icon-btn" id="openRegisterBtn">Inscription</button>
        </div>
        <div id="logged" style="display:none; align-items:center; gap:8px">
          <div class="user-bubble" id="badgeUser" style="color:white;font-size:14px;">Utilisateur</div>
          <button class="icon-btn" id="logoutBtn">D√©connexion</button>
        </div>
      </div>
    </nav>
  </header>

  <main>
    <!-- HERO -->
    <section class="hero" id="accueilSection" aria-label="Accueil">
      <div class="card">
        <h2>Bienvenue sur notre boutique d'objets 3D</h2>
        <p>
          Nous sommes Axel et Noah, deux adolescents passionn√©s par la cr√©ation et l'impression 3D.
          Nous avons lanc√© cette petite boutique locale pour montrer que la cr√©ativit√© et l‚Äôentrepreneuriat
          sont accessibles √† tous. Chaque objet est imagin√©, fabriqu√© et emball√© avec soin dans notre atelier.
          Merci de soutenir notre aventure !
        </p>
      </div>

      <div class="left">
        <h2>Objets 3D faits main ‚Äî Petite boutique</h2>
        <p>Produits imprim√©s localement, personnalisables. Paiement PayPal / CB (simulation) / √† la livraison.</p>
      </div>

      <div class="stats">
        <div style="text-align:right;">
          <div style="font-size:12px;color:var(--muted)">Connect√© en tant que :</div>
          <div id="userStatus" style="font-weight:700;color:var(--accent)">Invit√©</div>
        </div>
        <div class="box">
          <div style="font-size:13px; color:var(--muted)">Panier</div>
          <div style="font-weight:700; font-size:18px" id="nbPanierLarge">0</div>
        </div>
      </div>
    </section>

    <!-- BOUTIQUE -->
    <section id="boutiqueSection" style="display:none;" aria-label="Boutique">
      <h3>Nos produits</h3>
      <div class="grid" id="gridProduits" aria-live="polite"></div>
    </section>

    <!-- DETAILS -->
    <section id="detailsSection" style="display:none;" aria-label="D√©tails du produit">
      <div class="details-wrap">
        <div class="details-left">
          <div class="card">
            <div class="carousel-main" id="mainImageContainer">
              <img id="mainImage" src="" alt="Image du produit" />
            </div>
            <div class="thumbnails" id="thumbs" aria-label="Vignettes"></div>
          </div>
          <div class="card">
            <h3 id="detailTitre">Titre</h3>
            <p id="detailDescription" class="small-muted">Description...</p>
            <p class="small-muted" id="detailFab">Fabriqu√© √† ...</p>
          </div>
        </div>

        <aside class="details-right" aria-label="Options et achat">
          <div style="display:flex; justify-content:space-between; align-items:center">
            <div style="font-weight:700" id="detailPrix">‚Ç¨0.00</div>
            <div style="color:var(--muted); font-size:13px" id="detailQty">Stock : ‚Äî</div>
          </div>
          <div style="margin-top:12px">
            <label for="detailQuantiteInput">Quantit√©</label>
            <input type="number" id="detailQuantiteInput" min="1" value="1" />
            <div id="stockError" class="error-msg" role="alert" aria-live="polite"></div>
          </div>
          <div style="margin-top:12px; display:flex; gap:8px; flex-direction:column;">
            <button class="btn-primary" id="btnAddToCart">Ajouter au panier</button>
            <button class="btn-ghost" id="btnOrderSingle">Commander</button>
          </div>
          <div style="margin-top:16px; font-size:13px; color:var(--muted)">
            <strong>D√©tails techniques</strong>
            <div id="detailTech" style="margin-top:8px">PLA recycl√© ‚Ä¢ Impression FDM</div>
          </div>
        </aside>
      </div>
    </section>

    <!-- PANIER -->
    <section id="panierSection" style="display:none;" aria-label="Panier">
      <h3>Panier</h3>
      <div style="overflow:auto;">
        <table class="cart" aria-live="polite">
          <thead><tr><th>Produit</th><th>Quantit√©</th><th>Prix</th><th>Actions</th></tr></thead>
          <tbody id="panierTable"></tbody>
        </table>
      </div>
      <div style="display:flex; justify-content:space-between; margin-top:12px; align-items:center; gap:12px; flex-wrap:wrap;">
        <button class="btn-ghost" id="viderPanierBtn">Vider le panier</button>
        <div style="text-align:right">
          <div class="small-muted">Total :</div>
          <div style="font-weight:700; font-size:18px" id="totalPanier">‚Ç¨0.00</div>
          <button class="btn-primary" id="commanderPanierBtn" style="margin-top:8px">Commander le panier</button>
        </div>
      </div>
    </section>

    <!-- FORM COMMANDE -->
    <section id="formSection" style="display:none;" aria-label="Formulaire de commande">
      <h3>Commander</h3>
      <div class="card">
        <form id="orderForm" novalidate>
          <!-- Cl√© Web3Forms -->
          <input type="hidden" name="access_key" value="867b9f7b-a375-47c5-a0c0-ec184b69f529" />
          <!-- Email destinataire propri√©taire -->
          <input type="hidden" name="email_to" value="objet.3d.axel.et.noah@gmail.com" />
          <!-- Honeypot anti-bot -->
          <input type="text" name="botcheck" tabindex="-1" autocomplete="off" style="display:none" />

          <label for="prenom">Pr√©nom</label>
          <input id="prenom" name="prenom" type="text" required />
          <label for="nom">Nom</label>
          <input id="nom" name="nom" type="text" required />
          <label for="adresse">Adresse</label>
          <input id="adresse" name="adresse" type="text" required />
          <label for="codepostal">Code postal</label>
          <input id="codepostal" name="codepostal" type="text" pattern="[0-9]{5}" required />
          <label for="emailField">Email</label>
          <input id="emailField" name="email" type="email" required />

          <label for="quantite">Quantit√© totale</label>
          <input id="quantite" name="quantite" type="number" min="1" value="1" readonly />

          <label for="moyenPaiement">Moyen de paiement</label>
          <select id="moyenPaiement" name="moyenPaiement" required>
            <option value="">-- Choisir un moyen de paiement --</option>
            <option value="paypal">PayPal</option>
            <option value="paypalme">PayPal.me</option>
            <option value="virement">Virement bancaire</option>
            <option value="cb_simule">Carte bancaire (simulation)</option>
            <option value="cash">Paiement √† la livraison</option>
          </select>

          <div id="formStatus" class="small-muted" style="margin-top:8px;" aria-live="polite"></div>

          <div style="display:flex; gap:8px; margin-top:8px">
            <button class="btn-primary" type="submit" id="btnSubmit">Envoyer la commande</button>
            <button type="button" class="btn-ghost" id="btnCancelOrder">Annuler</button>
          </div>
        </form>
      </div>
    </section>

    <!-- MODAL AUTH -->
    <div class="modal-backdrop" id="authModalOverlay" role="dialog" aria-modal="true" aria-labelledby="authTitle">
      <div class="modal">
        <h3 id="authTitle">Connexion</h3>

        <div id="loginForm">
          <label for="loginEmail">Email</label>
          <input type="email" id="loginEmail" autocomplete="email" required />
          <label for="loginPassword">Mot de passe</label>
          <input type="password" id="loginPassword" autocomplete="current-password" required />
          <div class="modal-actions">
            <button type="button" class="btn-primary" id="loginBtn">Se connecter</button>
            <button type="button" class="btn-ghost" onclick="fermerAuth()">Fermer</button>
          </div>
          <div class="modal-toggle">
            Pas encore inscrit ? <a onclick="changerForm('register')">S'inscrire</a>
          </div>
        </div>

        <div id="registerForm" style="display:none;">
          <label for="regPrenom">Pr√©nom</label>
          <input type="text" id="regPrenom" required />
          <label for="regNom">Nom</label>
          <input type="text" id="regNom" required />
          <label for="regAdresse">Adresse</label>
          <input type="text" id="regAdresse" required />
          <label for="regCodepostal">Code Postal</label>
          <input type="text" id="regCodepostal" pattern="[0-9]{5}" required />
          <label for="regEmail">Email</label>
          <input type="email" id="regEmail" autocomplete="email" required />
          <label for="regEmailConfirm">Confirmer l'Email</label>
          <input type="email" id="regEmailConfirm" autocomplete="email" required />
          <label for="regPassword">Mot de passe</label>
          <input type="password" id="regPassword" autocomplete="new-password" required />
          <div class="small-muted">‚öôÔ∏è Min. 8 caract√®res, dont 1 lettre et 1 chiffre.</div>
          <div class="modal-actions">
            <button type="button" class="btn-primary" id="registerBtn">S'inscrire</button>
            <button type="button" class="btn-ghost" onclick="fermerAuth()">Fermer</button>
          </div>
          <div class="modal-toggle">
            D√©j√† inscrit ? <a onclick="changerForm('login')">Se connecter</a>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer class="site-footer" role="contentinfo">
    <div class="footer-left">
      <strong>Contact rapide</strong><br />
      mailto:objet.3d.axel.et.noah@gmail.comobjet.3d.axel.et.noah@gmail.com</a>
    </div>
    <div class="footer-contact">
      <div><strong>Quand connect√© :</strong></div>
      <ul>
        <li>Voir le panier et commander</li>
        <li>Enregistrer vos moyens de paiement</li>
        <li>Recevoir des notifications par e-mail</li>
      </ul>
      <div class="footer-social" style="margin-top:8px">
        <a href="https://www.instagram.com/objet_3d_a_et_n/
          https://upload.wikimedia.org/wikipedia/commons/e/e7/Instagram_logo_2016.svg">
          <span>Instagram</span>
        </a>
        <a href="https://www.tiktok.com/@objet_3d
          https://upload.wikimedia.org/wikipedia/en/a/a9/TikTok_logo.svg">
          <span>TikTok</span>
        </a>
      </div>
    </div>
  </footer>

  <script>
    /* ====================
       PRODUITS (neutres)
       ==================== */
    const produits = {
      objet1:{
        id:'objet1',
        titre:'bient√¥t dispo',
        description:'Porte-stylo √©l√©gant imprim√© en PLA recycl√©. Dimensions : 8√ó8√ó10 cm.'
           images:[
          'https://via.placeholder.com/800x600?text=Porte-stylo+1',
          'https://via.placeholder.com/800x600?text=Porte-stylo+2'
        ],
        fabrication:'Atelier local, PLA recycl√©',
        prix:12.99,
        stock:15,
        tech:'PLA recycl√© ‚Ä¢ Impression FDM'
      },
      objet2:{
        id:'objet2',
        titre:'Figurine r√©sine ‚Äî bient√¥t dispo',
        description:'Figurine d√©taill√©e, imprim√©e en r√©sine durable.',
        images:[
          'https://via.placeholder.com/800x600?text=Figurine+1',
          'https://via.placeholder.com/800x600?text=Figurine+2'
        ],
        fabrication:'R√©sine haute qualit√©',
        prix:24.50,
        stock:8,
        tech:'R√©sine SLA ‚Ä¢ D√©tails fins'
      },
      objet3:{
        id:'objet3',
        titre:'Vase g√©om√©trique ‚Äî preview',
        description:'Vase aux formes g√©om√©triques, id√©al pour la d√©co.',
        images:[
          'https://via.placeholder.com/800x600?text=Vase+1',
          'https://via.placeholder.com/800x600?text=Vase+2'
        ],
        fabrication:'PLA ‚Ä¢ Impression FDM',
        prix:18.75,
        stock:12,
        tech:'PLA ‚Ä¢ Impression FDM'
      },
    };

    /* ====================
       √âTAT
       ==================== */
    let panier = [];
    let logged = false;
    let currentUserName = '';
    let currentDetailId = null;

    /* ====================
       DOM
       ==================== */
    const nbPanierEl = document.getElementById('nbPanier');
    const nbPanierLarge = document.getElementById('nbPanierLarge');
    const panierTable = document.getElementById('panierTable');
    const totalPanierEl = document.getElementById('totalPanier');
    const orderForm = document.getElementById('orderForm');
    const formStatus = document.getElementById('formStatus');
    const btnSubmit = document.getElementById('btnSubmit');

    const sections = {
      accueil: document.getElementById('accueilSection'),
      boutique: document.getElementById('boutiqueSection'),
      details: document.getElementById('detailsSection'),
      panier: document.getElementById('panierSection'),
      form: document.getElementById('formSection')
    };

    function showSection(sec){
      Object.values(sections).forEach(s=>s.style.display='none');
      sec.style.display='block';
    }

    /* ====================
       NAVIGATION
       ==================== */
    document.getElementById('navAccueil').addEventListener('click',()=>showSection(sections.accueil));
    document.getElementById('navBoutique').addEventListener('click',()=>afficherBoutique());
    document.getElementById('navPanier').addEventListener('click',()=>{
      updatePanierUI();
      showSection(sections.panier);
    });

    function afficherBoutique(){
      showSection(sections.boutique);
      const grid = document.getElementById('gridProduits');
      grid.innerHTML = '';
      Object.values(produits).forEach(prod=>{
        const card = document.createElement('div');
        card.className = 'card';
        const isRupture = prod.stock === 0;
        card.innerHTML = `
          ${prod.images[0]}
          <h3>${prod.titre}</h3>
          <p>${prod.description}</p>
          <div class="meta">
            ${isRupture ? '<div class="stock-status">AUCUN STOCK (pour le moment)</div>' : `<div class="price">‚Ç¨${prod.prix.toFixed(2)}</div>`}
            <button class="btn-ghost voirBtn" data-id="${prod.id}" ${isRupture ? 'disabled' : ''}>Voir</button>
          </div>
        `;
        grid.appendChild(card);
      });
      document.querySelectorAll('.voirBtn').forEach(btn=>{
        btn.addEventListener('click',()=>showDetails(btn.dataset.id));
      });
    }

    function showDetails(id){
      const prod = produits[id];
      if(!prod || prod.stock === 0) return;
      currentDetailId = id;

      document.getElementById('mainImage').src = prod.images[0];
      document.getElementById('mainImage').alt = `Image du produit : ${prod.titre}`;
      document.getElementById('detailTitre').textContent = prod.titre;
      document.getElementById('detailDescription').textContent = prod.description;
      document.getElementById('detailFab').textContent = prod.fabrication;
      document.getElementById('detailPrix').textContent = `‚Ç¨${prod.prix.toFixed(2)}`;
      document.getElementById('detailQty').textContent = prod.stock === 0 ? 'AUCUN STOCK (pour le moment)' : `Stock : ${prod.stock}`;
      document.getElementById('detailTech').textContent = prod.tech;
      document.getElementById('detailQuantiteInput').value = 1;
      document.getElementById('detailQuantiteInput').max = prod.stock;
      const msg = document.getElementById('stockError');
      msg.className = 'error-msg';
      msg.textContent = '';

      const thumbs = document.getElementById('thumbs');
      thumbs.innerHTML = '';
      prod.images.forEach((img,i)=>{
        const t = document.createElement('img');
        t.src = img;
        t.alt = `Vignette ${i+1} du produit`;
        if(i===0) t.classList.add('active');
        t.addEventListener('click',()=>{
          document.getElementById('mainImage').src = img;
          thumbs.querySelectorAll('img').forEach(x=>x.classList.remove('active'));
          t.classList.add('active');
        });
        thumbs.appendChild(t);
      });

      showSection(sections.details);
    }

    document.getElementById('detailQuantiteInput').addEventListener('input',()=>{
      const prod = produits[currentDetailId];
      if(!prod) return;
      const input = document.getElementById('detailQuantiteInput');
      let val = parseInt(input.value) || 1;
      const error = document.getElementById('stockError');
      if(val > prod.stock){
        val = prod.stock;
        error.textContent = `‚ö†Ô∏è Stock limit√© √† ${prod.stock} articles`;
      } else if (val < 1) {
        val = 1;
        error.textContent = '';
      } else {
        error.textContent = '';
      }
      input.value = val;
    });

    document.getElementById('btnAddToCart').addEventListener('click',()=>{
      if(!currentDetailId) return;
      const prod = produits[currentDetailId];
      let quantite = parseInt(document.getElementById('detailQuantiteInput').value)||1;

      if(quantite > prod.stock){
        document.getElementById('stockError').textContent = `‚ùå Plus de stock ! Limit√© √† ${prod.stock}`;
        return;
      }

      const exist = panier.find(p=>p.id===currentDetailId);
      const qtyEnPanier = exist ? exist.quantite : 0;
      if(qtyEnPanier + quantite > prod.stock){
        document.getElementById('stockError').textContent = `‚ùå Seulement ${prod.stock - qtyEnPanier} articles restants`;
        return;
      }

      if(exist) exist.quantite += quantite;
      else panier.push({id:currentDetailId,quantite});

      const msg = document.getElementById('stockError');
      msg.className = 'success-msg';
      msg.textContent = '‚úÖ Produit ajout√© au panier !';
      updatePanierUI();
      setTimeout(()=>{ msg.className='error-msg'; msg.textContent=''; }, 2000);
    });

    function setOrderTotalQuantityField(){
      const totalQty = panier.reduce((acc,p)=>acc + p.quantite, 0);
      const qtyField = document.getElementById('quantite');
      if(qtyField){
        qtyField.value = Math.max(1, totalQty || 1); // emp√™che la valeur ‚Äú1‚Äù forc√©e si panier vide lors de tests
      }
    }

    function updatePanierUI(){
      const total = panier.reduce((acc,p)=>acc+p.quantite,0);
      nbPanierEl.textContent = total;
      nbPanierLarge.textContent = total;

      // maj champ quantit√© totale
      setOrderTotalQuantityField();

      panierTable.innerHTML = '';
      let montant = 0;
      panier.forEach(item=>{
        const prod = produits[item.id];
        const prixTotal = prod.prix * item.quantite;
        montant += prixTotal;
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${prod.titre}</td>
          <td><input type="number" min="1" max="${prod.stock}" value="${item.quantite}" data-id="${item.id}" class="qtyInput" /></td>
          <td>‚Ç¨${prixTotal.toFixed(2)}</td>
          <td><button class="btn-ghost removeBtn" data-id="${item.id}">Supprimer</button></td>
        `;
        panierTable.appendChild(row);
      });
      totalPanierEl.textContent = `‚Ç¨${montant.toFixed(2)}`;

      document.querySelectorAll('.qtyInput').forEach(input=>{
        input.addEventListener('change',e=>{
          const id = e.target.dataset.id;
          const val = Math.max(1, Math.min(parseInt(e.target.value) || 1, produits[id].stock));
          e.target.value = val;
          const p = panier.find(x=>x.id===id);
          if(p) p.quantite = val;
          updatePanierUI();
        });
      });
      document.querySelectorAll('.removeBtn').forEach(btn=>{
        btn.addEventListener('click',e=>{
          panier = panier.filter(x=>x.id!==e.target.dataset.id);
          updatePanierUI();
        });
      });

      // D√©sactiver "Commander le panier" si non connect√© ou panier vide
      const commanderBtn = document.getElementById('commanderPanierBtn');
      commanderBtn.disabled = !logged || panier.length===0;
    }

    document.getElementById('viderPanierBtn').addEventListener('click',()=>{
      if(confirm('Vider le panier ?')){
        panier=[];
        updatePanierUI();
      }
    });

    document.getElementById('commanderPanierBtn').addEventListener('click',()=>{
      if(!logged){
        alert('Vous devez √™tre connect√© pour commander !');
        ouvrirAuth('login');
        return;
      }
      if(panier.length===0){ alert('Panier vide !'); return; }
      setOrderTotalQuantityField(); // force la bonne valeur juste avant l‚Äôaffichage
      showSection(sections.form);
    });

    document.getElementById('btnOrderSingle').addEventListener('click',()=>{
      if(!logged){
        alert('Vous devez √™tre connect√© pour commander !');
        ouvrirAuth('login');
        return;
      }
      if(!currentDetailId) return;
      if(!panier.find(p=>p.id===currentDetailId)){
        panier.push({id:currentDetailId, quantite: parseInt(document.getElementById('detailQuantiteInput').value)||1});
        updatePanierUI();
      }
      setOrderTotalQuantityField();
      showSection(sections.form);
    });

    document.getElementById('btnCancelOrder').addEventListener('click',()=>showSection(sections.accueil));

    /* ===========================
       COMMANDE ‚Üí WEB3FORMS
       =========================== */
    orderForm.addEventListener('submit', async (e)=>{
      e.preventDefault();

      // champs requis
      const prenom = document.getElementById('prenom').value.trim();
      const nom = document.getElementById('nom').value.trim();
      const email = document.getElementById('emailField').value.trim();
      const codepostal = document.getElementById('codepostal').value.trim();
      if(!prenom || !nom || !email){
        alert('Veuillez remplir au minimum pr√©nom, nom et email.');
        return;
      }
      if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){
        alert('Adresse e-mail invalide.');
        return;
      }
      if(!/^[0-9]{5}$/.test(codepostal)){
        alert('Code postal invalide (5 chiffres).');
        return;
      }

      // R√©cap panier
      const items = panier.map(item=>{
        const prod = produits[item.id];
        return {
          id: item.id,
          titre: prod.titre,
          quantite: item.quantite,
          prix_unitaire: prod.prix,
          prix_total: +(prod.prix * item.quantite).toFixed(2)
        };
      });
      const totalPanier = items.reduce((acc, it)=>acc + it.prix_total, 0).toFixed(2);

      // Met √† jour la quantit√© totale (fix principal)
      const totalQty = panier.reduce((acc,p)=>acc + p.quantite, 0);
      document.getElementById('quantite').value = Math.max(1, totalQty || 1);

      const data = new FormData(orderForm);
      data.append('subject', `Nouvelle commande ‚Äî ${prenom} ${nom}`);
      data.append('from_name', `${prenom} ${nom}`);
      data.append('cart_total_eur', `‚Ç¨${totalPanier}`);
      data.append('cart_items_json', JSON.stringify(items));
      data.append('logged_user', currentUserName || 'Invit√©');
      data.append('site', 'Objets 3D ‚Äî Axel & Noah');

      btnSubmit.disabled = true;
      formStatus.textContent = '‚è≥ Envoi en cours...';

      try {
        const res = await fetch('https://api.web3forms.com/submit', { method:'POST', body:data });
        const result = await res.json();
        if(result.success){
          formStatus.textContent = '‚úÖ Commande envoy√©e ! Merci üôè';
          alert('Commande envoy√©e ! Un e-mail de confirmation vous sera envoy√©.');
          panier = [];
          updatePanierUI();
          orderForm.reset();
          showSection(sections.accueil);
        }else{
          console.error('Web3Forms error:', result);
          formStatus.textContent = '‚ùå Erreur lors de l‚Äôenvoi. R√©essaie plus tard.';
          alert('Une erreur est survenue : ' + (result.message || 'Envoi impossible'));
        }
      } catch(err){
        console.error('Network error:', err);
        formStatus.textContent = '‚ùå Erreur r√©seau. V√©rifie ta connexion.';
        alert('Erreur r√©seau pendant l‚Äôenvoi. R√©essaie.');
      } finally {
        btnSubmit.disabled = false;
        setTimeout(()=>{ formStatus.textContent=''; }, 3500);
      }
    });

    /* ====================
       AUTH / EMAIL HELPERS
       ==================== */
    function ouvrirAuth(type){
      document.getElementById('authModalOverlay').classList.add('active');
      changerForm(type);
    }
    function fermerAuth(){
      document.getElementById('authModalOverlay').classList.remove('active');
    }
    function changerForm(type){
      const loginForm = document.getElementById('loginForm');
      const registerForm = document.getElementById('registerForm');
      const title = document.getElementById('authTitle');
      if(type === 'login'){
        loginForm.style.display = 'block';
        registerForm.style.display = 'none';
        title.textContent = 'Connexion';
      } else {
        loginForm.style.display = 'none';
        registerForm.style.display = 'block';
        title.textContent = 'Inscription';
      }
    }

    // stockage utilisateurs (local)
    function loadUsers(){
      try{ const raw = localStorage.getItem('users'); return raw ? JSON.parse(raw) : {}; }
      catch(e){ return {}; }
    }
    function saveUsers(users){ localStorage.setItem('users', JSON.stringify(users)); }
    let users = loadUsers();

    async function hashPassword(pass){
      const enc = new TextEncoder().encode(pass);
      const buf = await crypto.subtle.digest('SHA-256', enc);
      const arr = Array.from(new Uint8Array(buf));
      return arr.map(b=>b.toString(16).padStart(2,'0')).join('');
    }
    function isStrongPassword(pwd){ return typeof pwd==='string' && pwd.length>=8 && /[A-Za-z]/.test(pwd) && /[0-9]/.test(pwd); }

    function isValidEmailFormat(email){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email); }
    const bannedWords = ['example','test','no-reply','noreply'];
    function containsBannedWords(email){ const lower=email.toLowerCase(); return bannedWords.some(w=>lower.includes(w)); }

    document.getElementById('openLoginBtn').addEventListener('click',()=>ouvrirAuth('login'));
    document.getElementById('openRegisterBtn').addEventListener('click',()=>ouvrirAuth('register'));

    document.getElementById('logoutBtn').addEventListener('click',()=>{
      logged=false; currentUserName=''; updateUserUI(); updatePanierUI();
    });

    document.getElementById('loginBtn').addEventListener('click', async ()=>{
      const email = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPassword').value;

      if(!email || !password){ alert('Veuillez remplir tous les champs'); return; }
      if(!isValidEmailFormat(email)){ alert('Format de l‚Äôe-mail invalide.'); return; }

      const key = email.toLowerCase();
      const user = users[key];
      if(!user){ alert('Adresse non reconnue. Inscrivez-vous d‚Äôabord.'); return; }

      const passHash = await hashPassword(password);
      if(user.passHash !== passHash){ alert('Mot de passe incorrect.'); return; }

      // üîÅ MODIFICATION DEMAND√âE : pr√©nom uniquement (ou email en secours)
      currentUserName = user.prenom ? user.prenom : email;

      logged = true;
      updateUserUI();
      fermerAuth();
      document.getElementById('loginEmail').value = '';
      document.getElementById('loginPassword').value = '';
      updatePanierUI();
    });

    document.getElementById('registerBtn').addEventListener('click', async ()=>{
      const prenom = document.getElementById('regPrenom').value.trim();
      const nom = document.getElementById('regNom').value.trim();
      const adresse = document.getElementById('regAdresse').value.trim();
      const codepostal = document.getElementById('regCodepostal').value.trim();
      const email = document.getElementById('regEmail').value.trim();
      const emailConfirm = document.getElementById('regEmailConfirm').value.trim();
      const password = document.getElementById('regPassword').value;

      if(!prenom || !nom || !adresse || !codepostal || !email || !emailConfirm || !password){
        alert('Veuillez remplir tous les champs');
        return;
      }
      if(email !== emailConfirm){ alert('Les deux adresses e-mail ne correspondent pas.'); return; }
      if(!isValidEmailFormat(email)){ alert('Format de l‚Äôe-mail invalide.'); return; }
      if(!/^[0-9]{5}$/.test(codepostal)){ alert('Code postal invalide (5 chiffres).'); return; }
      if(containsBannedWords(email)){ alert('Adresse e-mail refus√©e.'); return; }
      if(!isStrongPassword(password)){ alert('Mot de passe trop faible. Min. 8 caract√®res avec lettres et chiffres.'); return; }

      const key = email.toLowerCase();
      if(users[key]){ alert('Cette adresse e-mail est d√©j√† utilis√©e.'); return; }

      const passHash = await hashPassword(password);
      users[key] = { prenom, nom, adresse, codepostal, passHash };
      saveUsers(users);

      // üîî Notification d‚Äôinscription via Web3Forms (Option A)
      try{
        const fd = new FormData();
        fd.append('access_key','867b9f7b-a375-47c5-a0c0-ec184b69f529');
        fd.append('email_to','objet.3d.axel.et.noah@gmail.com');
        fd.append('subject','Nouvelle inscription');
        fd.append('from_name', `${prenom} ${nom}`);
        fd.append('message', `Un nouvel utilisateur s'est inscrit.\nNom: ${prenom} ${nom}\nEmail: ${email}\nCode postal: ${codepostal}`);
        await fetch('https://api.web3forms.com/submit', { method:'POST', body:fd });
      }catch(err){
        console.warn('Notification inscription non envoy√©e (r√©seau) :', err);
      }

      alert(`‚úÖ Inscription r√©ussie ! Bienvenue ${prenom} ${nom}`);

      // üîÅ MODIFICATION DEMAND√âE : pr√©nom uniquement
      currentUserName = prenom;

      logged = true;
      updateUserUI();
      fermerAuth();

      // Reset
      document.getElementById('regPrenom').value = '';
      document.getElementById('regNom').value = '';
      document.getElementById('regAdresse').value = '';
      document.getElementById('regCodepostal').value = '';
      document.getElementById('regEmail').value = '';
      document.getElementById('regEmailConfirm').value = '';
      document.getElementById('regPassword').value = '';
      updatePanierUI();
    });

    function updateUserUI(){
      const notLogged = document.getElementById('notLogged');
      const loggedDiv = document.getElementById('logged');
      const userStatus = document.getElementById('userStatus');
      const badgeUser = document.getElementById('badgeUser');
      if(logged){
        notLogged.style.display = 'none';
        loggedDiv.style.display = 'flex';
        badgeUser.textContent = currentUserName;
        userStatus.textContent = currentUserName;
      } else {
        notLogged.style.display = 'flex';
        loggedDiv.style.display = 'none';
        userStatus.textContent = 'Invit√©';
      }
    }

    /* ====================
       BACK BUTTON
       ==================== */
    const backBtn = document.getElementById('backBtn');
    let sectionHistory = [];
    const originalShowSection = showSection;

    showSection = function(sec){
      if(sectionHistory[sectionHistory.length - 1] !== sec){
        sectionHistory.push(sec);
      }
      Object.values(sections).forEach(s => s.style.display = 'none');
      sec.style.display = 'block';
      backBtn.style.display = sectionHistory.length > 1 ? 'block' : 'none';
    };

    backBtn.addEventListener('click', () => {
      if(sectionHistory.length > 1){
        sectionHistory.pop();
        const prev = sectionHistory[sectionHistory.length - 1];
        Object.values(sections).forEach(s => s.style.display = 'none');
        prev.style.display = 'block';
      }
      backBtn.style.display = sectionHistory.length > 1 ? 'block' : 'none';
    });

    /* ====================
       INIT
       ==================== */
    updateUserUI();
    showSection(sections.accueil);
  </script>
</body>
</html>






