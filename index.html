<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Objets 3D ‚Äî Axel &amp; Noah</title>

<!-- PayPal SDK (optionnel/simulation) -->
https://www.paypal.com/sdk/js?client-id=7HSHKVRHRLSDJ&currency=EUR</script>

<style>
:root{
  --accent:#ff6600;
  --bg:#fafafa;
  --card:#ffffff;
  --dark:#222;
  --muted:#666;
  --maxw:980px;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter, "Segoe UI", Roboto, Arial, sans-serif;
  background:var(--bg);
  color:#111;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}

.back-btn{
  position:fixed;
  top:76px;
  left:16px;
  z-index:2500;
  background:black;
  color:white;
  border:none;
  border-radius:50%;
  width:42px;
  height:42px;
  font-size:20px;
  cursor:pointer;
  display:none;
}
.back-btn:hover{opacity:.85}

header{
  position:fixed;
  top:0; left:0; right:0;
  height:64px;
  background:linear-gradient(180deg,#111 0%, #1a1a1a 100%);
  color:white;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 16px;
  z-index:2000;
  box-shadow:0 4px 18px rgba(0,0,0,0.25);
}
.brand{ display:flex; gap:12px; align-items:center; }
.logo { width:44px; height:44px; border-radius:10px; background:var(--accent); display:flex; align-items:center; justify-content:center; font-weight:700; color:white; }
.brand h1{ font-size:18px; margin:0; letter-spacing:0.2px; }
nav.main { display:flex; gap:12px; align-items:center; }
button.icon-btn{ background:transparent; border:none; color:white; cursor:pointer; font-size:16px; padding:8px 10px; border-radius:8px; }
button.icon-btn:hover{ background:rgba(255,255,255,0.04) }

main{ padding-top:84px; max-width:var(--maxw); margin:24px auto; padding-left:16px; padding-right:16px; }

.hero{ display:flex; gap:20px; align-items:center; justify-content:space-between; background:linear-gradient(90deg,#fff 0%, #fffaf0 100%); padding:24px; border-radius:12px; box-shadow:0 6px 30px rgba(0,0,0,0.05); }
.hero .left h2{ margin:0 0 8px 0; color:var(--dark); }
.hero .left p{ margin:0; color:var(--muted) }

.grid { margin-top:20px; display:grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap:18px; }
.card{ background:var(--card); border-radius:12px; padding:14px; box-shadow:0 6px 18px rgba(0,0,0,0.06); display:flex; flex-direction:column; gap:12px; }
.card img{ width:100%; height:140px; object-fit:cover; border-radius:8px; }
.card h3{ margin:0; font-size:16px; color:var(--dark) }
.card p{ margin:0; color:var(--muted); font-size:14px; min-height:40px; }
.card .meta{ display:flex; align-items:center; justify-content:space-between; gap:8px }
.price{ font-weight:700; color:var(--accent) }
.stock-status{ font-size:13px; color:#d32f2f; font-weight:700; }

.details-wrap{ display:flex; gap:18px; align-items:flex-start; }
.details-left{ flex:1; }
.details-right{ width:320px; background:var(--card); padding:14px; border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,0.06) }
.carousel-main{ width:100%; height:300px; border-radius:10px; overflow:hidden; background:#eee; display:flex; align-items:center; justify-content:center; }
.carousel-main img{ width:100%; height:100%; object-fit:cover; }
.thumbnails{ display:flex; gap:8px; margin-top:8px; }
.thumbnails img{ height:56px; width:75px; object-fit:cover; border-radius:6px; cursor:pointer; opacity:.75; border:2px solid transparent }
.thumbnails img.active{ opacity:1; border-color:var(--accent) }
.error-msg { color: #d32f2f; font-size: 13px; margin-top: 4px; }

table.cart{ width:100%; border-collapse:collapse; background:var(--card); border-radius:12px; overflow:hidden; box-shadow:0 6px 18px rgba(0,0,0,0.06) }
table.cart th, table.cart td{ padding:12px 14px; text-align:left; border-bottom:1px solid #f0f0f0; font-size:14px }
table.cart thead{ background:#fafafa }
.btn-primary{ background:var(--accent); color:white; border:none; padding:12px; border-radius:8px; cursor:pointer; font-weight:700 }
.btn-primary:disabled{ opacity: 0.5; cursor: not-allowed; }
.btn-ghost{ background:#f5f5f5; border:1px solid #eee; padding:10px; border-radius:8px; cursor:pointer }
.small-muted{ font-size:13px; color:var(--muted) }

.modal-backdrop{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.5); z-index:3000; display:none; }
.modal-backdrop.active{ display:flex; }
.modal{ width:100%; max-width:480px; background:white; padding:18px; border-radius:12px; box-shadow:0 12px 40px rgba(0,0,0,0.25) }
.modal h3{ margin:0 0 12px 0; color:var(--accent); }
.modal label{ font-weight:bold; margin-top:8px; display:block; }
.modal input, .modal select{ width:100%; padding:8px; border:1px solid #ddd; border-radius:6px; margin-top:4px; }
.modal-toggle{ text-align:center; margin-top:12px; font-size:13px; }
.modal-toggle a{ color:var(--accent); cursor:pointer; text-decoration:underline; }
.modal-actions{ display:flex; gap:8px; margin-top:12px; }
.modal-actions button{ flex:1; }

footer.site-footer{ margin-top:28px; background:#0f0f0f; color:#ddd; padding:12px 16px; border-radius:10px; max-width:var(--maxw); margin-left:auto; margin-right:auto; display:flex; justify-content:space-between; align-items:center; gap:12px; }
.footer-left{ font-size:14px }
.footer-contact{ text-align:right; font-size:13px; color:#aaa }
.footer-contact ul{ margin:6px 0 0 0; padding-left:18px; color:#ccc }
.footer-social{ display:flex; gap:8px; align-items:center; }
.footer-social a img{ height:36px; width:36px; border-radius:6px; display:block }

@media (max-width:860px){
  .details-wrap{ flex-direction:column }
  .details-right{ width:100% }
  footer.site-footer{ flex-direction:column; gap:10px; text-align:center }
}
</style>
</head>
<body>

<button class="back-btn" id="backBtn">‚Üê</button>

<header>
  <div class="brand">
    <div class="logo">3D</div>
    <div>
      <h1>Objets 3D ‚Äî Axel &amp; Noah</h1>
      <div style="font-size:12px;color:#e6e6e6">Impression &amp; Cr√©ation locale</div>
    </div>
  </div>

  <nav class="main" aria-label="Navigation principale">
    <button class="icon-btn" id="navAccueil">Accueil</button>
    <button class="icon-btn" id="navBoutique">Boutique</button>
    <button class="icon-btn" id="navPanier">üõí <span id="nbPanier">0</span></button>
    <div id="authArea" style="display:flex; align-items:center; gap:8px">
      <div id="notLogged" style="display:flex; gap:8px;">
        <button class="icon-btn" id="openLoginBtn">Connexion</button>
        <button class="icon-btn" id="openRegisterBtn">Inscription</button>
      </div>
      <div id="logged" style="display:none; align-items:center; gap:8px">
        <div class="user-bubble" id="badgeUser" style="color:white;font-size:14px;">Utilisateur</div>
        <button class="icon-btn" id="logoutBtn">D√©connexion</button>
      </div>
    </div>
  </nav>
</header>

<main>
  <section class="hero" id="accueilSection">
    <div class="card">
      <h2>Bienvenue sur notre boutique d'objets 3D</h2>
      <p>Nous sommes Axel et Noah, deux adolescents de 15 ans passionn√©s par la cr√©ation et l'impression 3D. Nous avons d√©cid√© de lancer notre propre petite entreprise pour montrer que l'entreprenariat et la cr√©ativit√© ne sont pas r√©serv√©s aux adultes : les jeunes peuvent aussi innover, entreprendre et b√¢tir leurs propres projets.

Pour nous, la cr√©ativit√© est la cl√© de la r√©ussite. Chaque objet que nous proposons est imagin√©, fabriqu√© et emball√© avec soin dans notre atelier local. Merci de soutenir notre aventure !</p>
    </div>
    <div class="left">
      <h2>Objets 3D faits main ‚Äî Petite boutique</h2>
      <p>Produits imprim√©s localement, personnalisables. Paiement PayPal / CB (simulation) / √† la livraison.</p>
    </div>
    <div style="display:flex; gap:12px; align-items:center">
      <div style="text-align:right;">
        <div style="font-size:12px;color:var(--muted)">Connect√© en tant que :</div>
        <div id="userStatus" style="font-weight:700;color:var(--accent)">Invit√©</div>
      </div>
      <div style="background:#fff; padding:8px 12px; border-radius:8px; box-shadow:0 6px 18px rgba(0,0,0,0.06)">
        <div style="font-size:13px; color:var(--muted)">Panier</div>
        <div style="font-weight:700; font-size:18px" id="nbPanierLarge">0</div>
      </div>
    </div>
  </section>

  <section id="boutiqueSection" style="display:none;">
    <h3>Nos produits</h3>
    <div class="grid" id="gridProduits"></div>
  </section>

  <section id="detailsSection" style="display:none;">
    <div class="details-wrap">
      <div class="details-left">
        <div class="card">
          <div class="carousel-main" id="mainImageContainer"><img id="mainImage" src="" alt="image objet" /></div>
          <div class="thumbnails" id="thumbs"></div>
        </div>
        <div class="card">
          <h3 id="detailTitre">Titre</h3>
          <p id="detailDescription" class="small-muted">Description...</p>
          <p class="small-muted" id="detailFab">Fabriqu√© √† ...</p>
        </div>
      </div>
      <aside class="details-right">
        <div style="display:flex; justify-content:space-between; align-items:center">
          <div style="font-weight:700" id="detailPrix">‚Ç¨0.00</div>
          <div style="color:var(--muted); font-size:13px" id="detailQty">Stock : ‚Äî</div>
        </div>
        <div style="margin-top:12px">
          <label for="detailQuantiteInput">Quantit√©</label>
          <input type="number" id="detailQuantiteInput" min="1" value="1" />
          <div id="stockError" class="error-msg"></div>
        </div>
        <div style="margin-top:12px; display:flex; gap:8px; flex-direction:column;">
          <button class="btn-primary" id="btnAddToCart">Ajouter au panier</button>
          <button class="btn-ghost" id="btnOrderSingle">Commander</button>
        </div>
        <div style="margin-top:16px; font-size:13px; color:var(--muted)">
          <strong>D√©tails techniques</strong>
          <div id="detailTech" style="margin-top:8px">PLA recycl√© ‚Ä¢ Impression FDM</div>
        </div>
      </aside>
    </div>
  </section>

  <section id="panierSection" style="display:none;">
    <h3>Panier</h3>
    <div style="overflow:auto;">
      <table class="cart" aria-live="polite">
        <thead><tr><th>Produit</th><th>Quantit√©</th><th>Prix</th><th>Actions</th></tr></thead>
        <tbody id="panierTable"></tbody>
      </table>
    </div>
    <div style="display:flex; justify-content:space-between; margin-top:12px; align-items:center">
      <button class="btn-ghost" id="viderPanierBtn">Vider le panier</button>
      <div style="text-align:right">
        <div class="small-muted">Total :</div>
        <div style="font-weight:700; font-size:18px" id="totalPanier">‚Ç¨0.00</div>
        <button class="btn-primary" id="commanderPanierBtn" style="margin-top:8px">Commander le panier</button>
      </div>
    </div>
  </section>

  <section id="formSection" style="display:none;">
    <h3>Commander</h3>
    <div class="card">
      <form id="orderForm">
        <!-- Cl√© Web3Forms -->
        <input type="hidden" name="access_key" value="867b9f7b-a375-47c5-a0c0-ec184b69f529" />
        <!-- Honeypot anti-bot (optionnel) -->
        <input type="text" name="botcheck" tabindex="-1" autocomplete="off" style="display:none" />

        <label>Pr√©nom</label>
        <input id="prenom" name="prenom" type="text" required />
        <label>Nom</label>
        <input id="nom" name="nom" type="text" required />
        <label>Adresse</label>
        <input id="adresse" name="adresse" type="text" required />
        <label>Code postal</label>
        <input id="codepostal" name="codepostal" type="text" pattern="[0-9]{5}" required />
        <label>Email</label>
        <input id="emailField" name="email" type="email" required />
        <label>Quantit√© totale</label>
        <input id="quantite" name="quantite" type="number" min="1" value="1" />
        <label>Moyen de paiement</label>
        <select id="moyenPaiement" name="moyenPaiement" required>
          <option value="">-- Choisir un moyen de paiement --</option>
          <option value="paypal">PayPal</option>
          <option value="paypalme">PayPal.me</option>
          <option value="virement">Virement bancaire</option>
          <option value="cb_simule">Carte bancaire (simulation)</option>
          <option value="cash">Paiement √† la livraison</option>
        </select>

        <div id="formStatus" class="small-muted" style="margin-top:8px;"></div>

        <div style="display:flex; gap:8px; margin-top:8px">
          <button class="btn-primary" type="submit" id="btnSubmit">Envoyer la commande</button>
          <button type="button" class="btn-ghost" id="btnCancelOrder">Annuler</button>
        </div>
      </form>
    </div>
  </section>

  <div class="modal-backdrop" id="authModalOverlay">
    <div class="modal">
      <h3 id="authTitle">Connexion</h3>
      
      <div id="loginForm">
        <label for="loginEmail">Email</label>
        <input type="email" id="loginEmail" required />
        <label for="loginPassword">Mot de passe</label>
        <input type="password" id="loginPassword" required />
        <div class="modal-actions">
          <button type="button" class="btn-primary" onclick="seConnecter()">Se connecter</button>
          <button type="button" class="btn-ghost" onclick="fermerAuth()">Fermer</button>
        </div>
        <div class="modal-toggle">
          Pas encore inscrit ? <a onclick="changerForm('register')">S'inscrire</a>
        </div>
      </div>

      <div id="registerForm" style="display:none;">
        <label for="regPrenom">Pr√©nom</label>
        <input type="text" id="regPrenom" required />
        <label for="regNom">Nom</label>
        <input type="text" id="regNom" required />
        <label for="regAdresse">Adresse</label>
        <input type="text" id="regAdresse" required />
        <label for="regCodepostal">Code Postal</label>
        <input type="text" id="regCodepostal" pattern="[0-9]{5}" required />
        <label for="regEmail">Email</label>
        <input type="email" id="regEmail" required />
        <!-- Ajout : confirmation email -->
        <label for="regEmailConfirm">Confirmer l'Email</label>
        <input type="email" id="regEmailConfirm" required />
        <label for="regPassword">Mot de passe</label>
        <input type="password" id="regPassword" required />
        <div class="modal-actions">
          <button type="button" class="btn-primary" onclick="sInscrire()">S'inscrire</button>
          <button type="button" class="btn-ghost" onclick="fermerAuth()">Fermer</button>
        </div>
        <div class="modal-toggle">
          D√©j√† inscrit ? <a onclick="changerForm('login')">Se connecter</a>
        </div>
      </div>
    </div>
  </div>

</main>

<footer class="site-footer" role="contentinfo">
  <div class="footer-left">
    <strong>Contact rapide</strong><br>
    <span class="small-muted">objet.3d.axel.et.noah@gmail.com</span>
  </div>
  <div class="footer-contact">
    <div><strong>Quand connect√© :</strong></div>
    <ul>
      <li>Voir le panier et commander</li>
      <li>Enregistrer vos moyens de paiement</li>
      <li>Recevoir notifications par e-mail</li>
    </ul>
    <div class="footer-social" style="margin-top:8px">
      https://www.instagram.com/objet_3d_a_et_n/
        https://upload.wikimedia.org/wikipedia/commons/e/e7/Instagram_logo_2016.svg
      </a>
      https://www.tiktok.com/@objet_3d
        https://upload.wikimedia.org/wikipedia/en/a/a9/TikTok_logo.svg
      </a>
    </div>
  </div>
</footer>

<script>
/* ====================
   DATA PRODUITS
   ==================== */
/* ‚ö†Ô∏è Remets tes propres titres/descriptions si tu veux.
   J‚Äôai mis du neutre ici. */
const produits = {
  objet1:{
    id:'objet1',
    titre:'Robin ntm ‚Äî √† venir sur le site',
    description:'Porte-stylo √©l√©gant imprim√© en PLA recycl√©. Dimensions : 8x8x10 cm.',
    images:[
      'https://via.placeholder.com/800x600?text=Porte-stylo+1',
      'https://via.placeholder.com/800x600?text=Porte-stylo+2'
    ],
    fabrication:'Atelier local, PLA recycl√©',
    prix:12.99,
    stock:15,
    tech:'PLA recycl√© ‚Ä¢ Impression FDM'
  },
  objet2:{
    id:'objet2',
    titre:'Robin arrete de stolker ‚Äî bient√¥t dispo',
    description:'Figurine d√©taill√©e, imprim√©e en r√©sine durable.',
    images:[
      'https://via.placeholder.com/800x600?text=Figurine+1',
      'https://via.placeholder.com/800x600?text=Figurine+2'
    ],
    fabrication:'R√©sine haute qualit√©',
    prix:24.50,
    stock:8,
    tech:'R√©sine SLA ‚Ä¢ D√©tails fins'
  },
  objet3:{
    id:'objet3',
    titre:'Toujours plus robin va te faire aussi ‚Äî preview',
    description:'Vase aux formes g√©om√©triques, id√©al pour la d√©co.',
    images:[
      'https://via.placeholder.com/800x600?text=Vase+1',
      'https://via.placeholder.com/800x600?text=Vase+2'
    ],
    fabrication:'PLA ‚Ä¢ Impression FDM',
    prix:18.75,
    stock:12,
    tech:'PLA ‚Ä¢ Impression FDM'
  },
};

let panier = [];
let logged = false;
let currentUserName = '';
let currentDetailId = null;

/* ====================
   DOM
   ==================== */
const nbPanierEl = document.getElementById('nbPanier');
const nbPanierLarge = document.getElementById('nbPanierLarge');
const panierTable = document.getElementById('panierTable');
const totalPanierEl = document.getElementById('totalPanier');

const sections = {
  accueil: document.getElementById('accueilSection'),
  boutique: document.getElementById('boutiqueSection'),
  details: document.getElementById('detailsSection'),
  panier: document.getElementById('panierSection'),
  form: document.getElementById('formSection')
};

function showSection(sec){
  Object.values(sections).forEach(s=>s.style.display='none');
  sec.style.display='block';
}

/* ====================
   NAVIGATION
   ==================== */
document.getElementById('navAccueil').addEventListener('click',()=>showSection(sections.accueil));
document.getElementById('navBoutique').addEventListener('click',()=>afficherBoutique());
document.getElementById('navPanier').addEventListener('click',()=>{
  updatePanierUI();
  showSection(sections.panier);
});

function afficherBoutique(){
  showSection(sections.boutique);
  const grid = document.getElementById('gridProduits');
  grid.innerHTML = '';
  Object.values(produits).forEach(prod=>{
    const card = document.createElement('div');
    card.className = 'card';
    const isRupture = prod.stock === 0;
    // ‚úÖ image affich√©e correctement
    card.innerHTML = `
      ${prod.images[0]}
      <h3>${prod.titre}</h3>
      <p>${prod.description}</p>
      <div class="meta">
        ${isRupture ? '<div class="stock-status">AUCUN STOCK (pour le moment)</div>' : `<div class="price">‚Ç¨${prod.prix.toFixed(2)}</div>`}
        <button class="btn-ghost voirBtn" data-id="${prod.id}" ${isRupture ? 'disabled' : ''}>Voir</button>
      </div>
    `;
    grid.appendChild(card);
  });
  document.querySelectorAll('.voirBtn').forEach(btn=>{
    btn.addEventListener('click',()=>showDetails(btn.dataset.id));
  });
}

function showDetails(id){
  const prod = produits[id];
  if(!prod || prod.stock === 0) return;
  currentDetailId = id;
  
  document.getElementById('mainImage').src = prod.images[0];
  document.getElementById('detailTitre').textContent = prod.titre;
  document.getElementById('detailDescription').textContent = prod.description;
  document.getElementById('detailFab').textContent = prod.fabrication;
  document.getElementById('detailPrix').textContent = `‚Ç¨${prod.prix.toFixed(2)}`;
  document.getElementById('detailQty').textContent = prod.stock === 0 ? 'AUCUN STOCK (pour le moment)' : `Stock : ${prod.stock}`;
  document.getElementById('detailTech').textContent = prod.tech;
  document.getElementById('detailQuantiteInput').value = 1;
  document.getElementById('detailQuantiteInput').max = prod.stock;
  document.getElementById('stockError').textContent = '';
  
  const thumbs = document.getElementById('thumbs');
  thumbs.innerHTML = '';
  prod.images.forEach((img,i)=>{
    const t = document.createElement('img');
    t.src = img;
    if(i===0) t.classList.add('active');
    t.addEventListener('click',()=>{
      document.getElementById('mainImage').src = img;
      thumbs.querySelectorAll('img').forEach(x=>x.classList.remove('active'));
      t.classList.add('active');
    });
    thumbs.appendChild(t);
  });
  
  showSection(sections.details);
}

document.getElementById('detailQuantiteInput').addEventListener('input',()=>{
  const prod = produits[currentDetailId];
  if(!prod) return;
  const val = parseInt(document.getElementById('detailQuantiteInput').value) || 1;
  const error = document.getElementById('stockError');
  if(val > prod.stock){
    error.textContent = `‚ö†Ô∏è Stock limit√© √† ${prod.stock} articles`;
    document.getElementById('detailQuantiteInput').value = prod.stock;
  } else if (val < 1) {
    document.getElementById('detailQuantiteInput').value = 1;
    error.textContent = '';
  } else {
    error.textContent = '';
  }
});

document.getElementById('btnAddToCart').addEventListener('click',()=>{
  if(!currentDetailId) return;
  const prod = produits[currentDetailId];
  let quantite = parseInt(document.getElementById('detailQuantiteInput').value)||1;
  
  if(quantite > prod.stock){
    document.getElementById('stockError').textContent = `‚ùå Plus de stock ! Limit√© √† ${prod.stock}`;
    return;
  }
  
  const exist = panier.find(p=>p.id===currentDetailId);
  const qtyEnPanier = exist ? exist.quantite : 0;
  if(qtyEnPanier + quantite > prod.stock){
    document.getElementById('stockError').textContent = `‚ùå Seulement ${prod.stock - qtyEnPanier} articles restants`;
    return;
  }
  
  if(exist) exist.quantite += quantite;
  else panier.push({id:currentDetailId,quantite});
  
  document.getElementById('stockError').textContent = '‚úÖ Produit ajout√© au panier !';
  updatePanierUI();
  setTimeout(()=>{ document.getElementById('stockError').textContent = ''; }, 2000);
});

function updatePanierUI(){
  const total = panier.reduce((acc,p)=>acc+p.quantite,0);
  nbPanierEl.textContent = total;
  nbPanierLarge.textContent = total;
  
  panierTable.innerHTML = '';
  let montant = 0;
  panier.forEach(item=>{
    const prod = produits[item.id];
    const prixTotal = prod.prix * item.quantite;
    montant += prixTotal;
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${prod.titre}</td>
      <td><input type="number" min="1" max="${prod.stock}" value="${item.quantite}" data-id="${item.id}" class="qtyInput" /></td>
      <td>‚Ç¨${prixTotal.toFixed(2)}</td>
      <td><button class="btn-ghost removeBtn" data-id="${item.id}">Supprimer</button></td>
    `;
    panierTable.appendChild(row);
  });
  totalPanierEl.textContent = `‚Ç¨${montant.toFixed(2)}`;
  
  document.querySelectorAll('.qtyInput').forEach(input=>{
    input.addEventListener('change',e=>{
      const id = e.target.dataset.id;
      const val = Math.max(1, Math.min(parseInt(e.target.value) || 1, produits[id].stock));
      e.target.value = val;
      const p = panier.find(x=>x.id===id);
      if(p) p.quantite = val;
      updatePanierUI();
    });
  });
  document.querySelectorAll('.removeBtn').forEach(btn=>{
    btn.addEventListener('click',e=>{
      panier = panier.filter(x=>x.id!==e.target.dataset.id);
      updatePanierUI();
    });
  });
}

document.getElementById('viderPanierBtn').addEventListener('click',()=>{
  if(confirm('Vider le panier ?')){
    panier=[];
    updatePanierUI();
  }
});

document.getElementById('commanderPanierBtn').addEventListener('click',()=>{
  if(!logged){
    alert('Vous devez √™tre connect√© pour commander !');
    ouvrirAuth('login');
    return;
  }
  if(panier.length===0){ alert('Panier vide !'); return; }
  showSection(sections.form);
});

document.getElementById('btnOrderSingle').addEventListener('click',()=>{
  if(!logged){
    alert('Vous devez √™tre connect√© pour commander !');
    ouvrirAuth('login');
    return;
  }
  if(!currentDetailId) return;
  // Optionnel : pousser l‚Äôarticle courant dans le panier si vide
  if(!panier.find(p=>p.id===currentDetailId)){
    panier.push({id:currentDetailId, quantite: parseInt(document.getElementById('detailQuantiteInput').value)||1});
    updatePanierUI();
  }
  showSection(sections.form);
});

document.getElementById('btnCancelOrder').addEventListener('click',()=>showSection(sections.accueil));

/* ===========================
   SOUMISSION WEB3FORMS
   =========================== */
const orderForm = document.getElementById('orderForm');
const formStatus = document.getElementById('formStatus');
const btnSubmit = document.getElementById('btnSubmit');

orderForm.addEventListener('submit', async (e)=>{
  e.preventDefault();

  // Validation simple c√¥t√© client
  const prenom = document.getElementById('prenom').value.trim();
  const nom = document.getElementById('nom').value.trim();
  const email = document.getElementById('emailField').value.trim();
  if(!prenom || !nom || !email){
    alert('Veuillez remplir au minimum pr√©nom, nom et email.');
    return;
  }

  // Construire le r√©capitulatif du panier
  const items = panier.map(item=>{
    const prod = produits[item.id];
    return {
      id: item.id,
      titre: prod.titre,
      quantite: item.quantite,
      prix_unitaire: prod.prix,
      prix_total: +(prod.prix * item.quantite).toFixed(2)
    };
  });
  const totalPanier = items.reduce((acc, it)=>acc + it.prix_total, 0).toFixed(2);

  // Pr√©parer FormData pour Web3Forms
  const data = new FormData(orderForm);
  // M√©tadonn√©es utiles pour l‚Äôemail
  data.append('subject', `Nouvelle commande ‚Äî ${prenom} ${nom}`);
  data.append('from_name', `${prenom} ${nom}`);
  data.append('cart_total_eur', `‚Ç¨${totalPanier}`);
  data.append('cart_items_json', JSON.stringify(items));
  data.append('logged_user', currentUserName || 'Invit√©');
  data.append('site', 'Objets 3D ‚Äî Axel & Noah');

  // UI : d√©sactiver le bouton et afficher statut
  btnSubmit.disabled = true;
  formStatus.textContent = '‚è≥ Envoi en cours...';

  try {
    const res = await fetch('https://api.web3forms.com/submit', {
      method: 'POST',
      body: data
    });
    const result = await res.json();

    if(result.success){
      formStatus.textContent = '‚úÖ Commande envoy√©e ! Merci üôè';
      alert('Commande envoy√©e ! Un e-mail de confirmation sera envoy√©.');
      // Reset panier et UI
      panier = [];
      updatePanierUI();
      orderForm.reset();
      showSection(sections.accueil);
    } else {
      console.error('Web3Forms error:', result);
      formStatus.textContent = '‚ùå Erreur lors de l‚Äôenvoi. R√©essaie plus tard.';
      alert('Une erreur est survenue : ' + (result.message || 'Envoi impossible'));
    }
  } catch(err){
    console.error('Network error:', err);
    formStatus.textContent = '‚ùå Erreur r√©seau. V√©rifie ta connexion.';
    alert('Erreur r√©seau pendant l‚Äôenvoi. R√©essaie.');
  } finally {
    btnSubmit.disabled = false;
    setTimeout(()=>{ formStatus.textContent=''; }, 3500);
  }
});

/* ====================
   EMAIL & AUTH HELPERS
   ==================== */

// Emails enregistr√©s (persist√©s en localStorage)
const registeredEmails = new Set(JSON.parse(localStorage.getItem('registeredEmails') || '[]'));
function saveRegisteredEmails(){
  localStorage.setItem('registeredEmails', JSON.stringify([...registeredEmails]));
}

// V√©rif format basique
function isValidEmailFormat(email){
  return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
}

// Liste de mots √† bannir (√† PERSONNALISER chez toi)
// (exemples neutres ‚Äî ajoute tes propres mots si besoin)
const motsInterdits = ['example', 'test', 'no-reply', 'noreply'];

function containsBannedWords(email){
  const lower = email.toLowerCase();
  return motsInterdits.some(w => lower.includes(w));
}

// Whitelist de domaines fr√©quents (optionnel)
const domainesAcceptes = [
  'gmail.com','outlook.com','hotmail.com','live.com',
  'yahoo.fr','yahoo.com','proton.me','protonmail.com',
  'icloud.com','orange.fr','sfr.fr','free.fr'
];

function looksLikeUsableDomain(email){
  const domain = email.split('@')[1]?.toLowerCase();
  if(!domain) return false;
  return domainesAcceptes.includes(domain) || (domain.includes('.') && domain.length > 3);
}

/* ====================
   AUTH
   ==================== */
function ouvrirAuth(type){
  document.getElementById('authModalOverlay').classList.add('active');
  changerForm(type);
}
function fermerAuth(){
  document.getElementById('authModalOverlay').classList.remove('active');
}
function changerForm(type){
  const loginForm = document.getElementById('loginForm');
  const registerForm = document.getElementById('registerForm');
  const title = document.getElementById('authTitle');
  
  if(type === 'login'){
    loginForm.style.display = 'block';
    registerForm.style.display = 'none';
    title.textContent = 'Connexion';
  } else {
    loginForm.style.display = 'none';
    registerForm.style.display = 'block';
    title.textContent = 'Inscription';
  }
}

function seConnecter(){
  const email = document.getElementById('loginEmail').value.trim();
  const password = document.getElementById('loginPassword').value;

  if(!email || !password){
    alert('Veuillez remplir tous les champs');
    return;
  }
  if(!isValidEmailFormat(email)){
    alert('Format de l‚Äôadresse email invalide.');
    return;
  }

  const emailKey = email.toLowerCase();
  if(!registeredEmails.has(emailKey)){
    alert('Adresse non reconnue. Inscrivez-vous d‚Äôabord.');
    return;
  }

  currentUserName = email;
  logged = true;
  updateUserUI();
  fermerAuth();
  document.getElementById('loginEmail').value = '';
  document.getElementById('loginPassword').value = '';
}

function sInscrire(){
  const prenom = document.getElementById('regPrenom').value.trim();
  const nom = document.getElementById('regNom').value.trim();
  const adresse = document.getElementById('regAdresse').value.trim();
  const codepostal = document.getElementById('regCodepostal').value.trim();
  const email = document.getElementById('regEmail').value.trim();
  const emailConfirm = document.getElementById('regEmailConfirm').value.trim();
  const password = document.getElementById('regPassword').value;

  if(!prenom || !nom || !adresse || !codepostal || !email || !emailConfirm || !password){
    alert('Veuillez remplir tous les champs');
    return;
  }

  if(email !== emailConfirm){
    alert('Les deux adresses email ne correspondent pas.');
    return;
  }

  if(!isValidEmailFormat(email)){
    alert('Format de l‚Äôadresse email invalide.');
    return;
  }

  if(!looksLikeUsableDomain(email)){
    alert('Le domaine de l‚Äôadresse email semble invalide.');
    return;
  }

  if(containsBannedWords(email)){
    alert('Adresse email refus√©e.');
    return;
  }

  const emailKey = email.toLowerCase();
  if(registeredEmails.has(emailKey)){
    alert('Cette adresse email est d√©j√† utilis√©e.');
    return;
  }

  // OK : enregistrement local + connexion
  registeredEmails.add(emailKey);
  saveRegisteredEmails();

  alert(`‚úÖ Inscription r√©ussie ! Bienvenue ${prenom} ${nom}`);
  currentUserName = prenom; // ou email, comme tu veux
  logged = true;
  updateUserUI();
  fermerAuth();

  // Reset des champs
  document.getElementById('regPrenom').value = '';
  document.getElementById('regNom').value = '';
  document.getElementById('regAdresse').value = '';
  document.getElementById('regCodepostal').value = '';
  document.getElementById('regEmail').value = '';
  document.getElementById('regEmailConfirm').value = '';
  document.getElementById('regPassword').value = '';
}

function updateUserUI(){
  const notLogged = document.getElementById('notLogged');
  const loggedDiv = document.getElementById('logged');
  const userStatus = document.getElementById('userStatus');
  const badgeUser = document.getElementById('badgeUser');
  
  if(logged){
    notLogged.style.display = 'none';
    loggedDiv.style.display = 'flex';
    badgeUser.textContent = currentUserName;
    userStatus.textContent = currentUserName;
  } else {
    notLogged.style.display = 'flex';
    loggedDiv.style.display = 'none';
    userStatus.textContent = 'Invit√©';
  }
}
document.getElementById('openLoginBtn').addEventListener('click',()=>ouvrirAuth('login'));
document.getElementById('openRegisterBtn').addEventListener('click',()=>ouvrirAuth('register'));
document.getElementById('logoutBtn').addEventListener('click',()=>{ logged=false; updateUserUI(); });

/* ====================
   BACK BUTTON (historique)
   ==================== */
const backBtn = document.getElementById('backBtn');
let sectionHistory = [];
const originalShowSection = showSection;

showSection = function(sec){
  if(sectionHistory[sectionHistory.length - 1] !== sec){
    sectionHistory.push(sec);
  }
  Object.values(sections).forEach(s => s.style.display = 'none');
  sec.style.display = 'block';
  backBtn.style.display = sectionHistory.length > 1 ? 'block' : 'none';
};

backBtn.addEventListener('click', () => {
  if(sectionHistory.length > 1){
    sectionHistory.pop();
    const prev = sectionHistory[sectionHistory.length - 1];
    Object.values(sections).forEach(s => s.style.display = 'none');
    prev.style.display = 'block';
  }
  backBtn.style.display = sectionHistory.length > 1 ? 'block' : 'none';
});

updateUserUI();
showSection(sections.accueil);
</script>
</body>
</html>
